{"version":3,"file":"ArrayField.js","sourceRoot":"","sources":["../../src/fields/ArrayField.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAuB,MAAM,KAAK,CAAC;AAChD,OAAO,EAAE,WAAW,EAAE,MAAM,YAAY,CAAC;AACzC,OAAO,yDAAyD,CAAC;AACjE,OAAO,qDAAqD,CAAC;AAI7D,MAAM,UAAU,gBAAgB,CAC9B,GAAW,EACX,MAAkB,EAClB,KAAc,EACd,QAAuB,EACvB,OAAiB,EAAE,EACnB,OAAe,EAAE,EACjB,SAA4B,EAAE,EAC9B,UAA0B,EAAE;IAE5B,MAAM,KAAK,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAc,CAAC;IAC/D,MAAM,UAAU,GAAI,MAAM,CAAC,KAAoB,IAAI,EAAE,CAAC;IAEtD,MAAM,SAAS,GAAG,GAAG,EAAE;QACrB,IAAI,OAAgB,CAAC;QACrB,MAAM,WAAW,GAAG,MAAM,CAAC,KAAmB,CAAC;QAE/C,IAAI,WAAW,EAAE,CAAC;YAChB,IAAI,WAAW,CAAC,IAAI,KAAK,QAAQ;gBAAE,OAAO,GAAG,EAAE,CAAC;YAChD,IAAI,WAAW,CAAC,IAAI,KAAK,QAAQ,IAAI,WAAW,CAAC,IAAI,KAAK,SAAS;gBAAE,OAAO,GAAG,CAAC,CAAC;YACjF,IAAI,WAAW,CAAC,IAAI,KAAK,SAAS;gBAAE,OAAO,GAAG,KAAK,CAAC;YACpD,IAAI,WAAW,CAAC,IAAI,KAAK,QAAQ;gBAAE,OAAO,GAAG,EAAE,CAAC;YAChD,IAAI,WAAW,CAAC,IAAI,KAAK,OAAO;gBAAE,OAAO,GAAG,EAAE,CAAC;QACjD,CAAC;QAED,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAK,EAAE,OAAO,CAAC,CAAC;QACrC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,CAAC,KAAa,EAAE,EAAE;QACrC,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC;QACrD,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,CAAC,KAAa,EAAE,GAAY,EAAE,EAAE;QACnD,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC;QAC5B,QAAQ,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;QACtB,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,OAAO,IAAI,CAAA;;;2CAG8B,MAAM,CAAC,KAAK,IAAI,GAAG;yCACrB,SAAS;;;;;;;UAOxC,KAAK,CAAC,GAAG,CACT,CAAC,IAAI,EAAE,KAAK,EAAkB,EAAE,CAAC,IAAI,CAAA;;;gBAG/B,WAAW,CACX,MAAM,CAAC,KAAK,CAAC,EACb,UAAU,EACV,IAAI,EACJ,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC,YAAY,CAAC,KAAK,EAAE,GAAG,CAAC,EACvC,IAAI,EACJ,GAAG,IAAI,IAAI,KAAK,EAAE,EAClB,MAAM,EACN,OAAO,CACR;;sEAEuD,GAAG,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC;;;;WAIpF,CACF;;;GAGN,CAAC;AACJ,CAAC","sourcesContent":["import { html, type TemplateResult } from 'lit';\nimport { renderField } from './index.js';\nimport '@awesome.me/webawesome/dist/components/button/button.js';\nimport '@awesome.me/webawesome/dist/components/icon/icon.js';\nimport type { ChangeHandler, JSONSchema, UISchema, WidgetRegistry } from '../types.js';\nimport type { ValidationError } from '../utils/validator.js';\n\nexport function renderArrayField(\n  key: string,\n  schema: JSONSchema,\n  value: unknown,\n  onChange: ChangeHandler,\n  view: UISchema = {},\n  path: string = '',\n  errors: ValidationError[] = [],\n  widgets: WidgetRegistry = {},\n) {\n  const items = (Array.isArray(value) ? value : []) as unknown[];\n  const itemSchema = (schema.items as JSONSchema) || {};\n\n  const handleAdd = () => {\n    let newItem: unknown;\n    const itemsSchema = schema.items as JSONSchema;\n\n    if (itemsSchema) {\n      if (itemsSchema.type === 'string') newItem = '';\n      if (itemsSchema.type === 'number' || itemsSchema.type === 'integer') newItem = 0;\n      if (itemsSchema.type === 'boolean') newItem = false;\n      if (itemsSchema.type === 'object') newItem = {};\n      if (itemsSchema.type === 'array') newItem = [];\n    }\n\n    const newItems = [...items, newItem];\n    onChange(newItems);\n  };\n\n  const handleRemove = (index: number) => {\n    const newItems = items.filter((_, i) => i !== index);\n    onChange(newItems);\n  };\n\n  const handleChange = (index: number, val: unknown) => {\n    const newItems = [...items];\n    newItems[index] = val;\n    onChange(newItems);\n  };\n\n  return html`\n    <div class=\"array-field\" style=\"border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;\">\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;\">\n        <label style=\"font-weight: 500;\">${schema.title || key}</label>\n        <wa-button size=\"small\" @click=${handleAdd}>\n          <wa-icon slot=\"prefix\" name=\"plus\"></wa-icon>\n          Add\n        </wa-button>\n      </div>\n\n      <div class=\"array-items\" style=\"display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem;\">\n        ${items.map(\n          (item, index): TemplateResult => html`\n          <div class=\"array-item\" style=\"display: flex; gap: 0.5rem; align-items: flex-start; border: 1px solid #ddd; padding: 0.5rem; border-radius: 4px;\">\n            <div style=\"flex: 1;\">\n              ${renderField(\n                String(index),\n                itemSchema,\n                item,\n                (_key, val) => handleChange(index, val),\n                view,\n                `${path}/${index}`,\n                errors,\n                widgets,\n              )}\n            </div>\n            <wa-button variant=\"danger\" size=\"small\" outline @click=${() => handleRemove(index)}>\n               <wa-icon name=\"trash\"></wa-icon>\n            </wa-button>\n          </div>\n          `,\n        )}\n      </div>\n    </div>\n  `;\n}\n"]}