{"version":3,"file":"json-schema-form.js","sourceRoot":"","sources":["../src/json-schema-form.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, LitElement, type PropertyValues, TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport {\n  renderField,\n  arrayFieldStyles,\n  compositionFieldStyles,\n  fileFieldStyles,\n  nullFieldStyles,\n  objectFieldStyles,\n} from './fields/index.js';\nimport type { JSONSchema, UISchema, WidgetRegistry } from './types.js';\nimport { createValidator, type SchemaValidator, type ValidationError } from './utils/validator.js';\nimport '@awesome.me/webawesome/dist/components/callout/callout.js';\n\n@customElement('wa-json-schema-form')\nexport class JsonSchemaForm extends LitElement {\n  static styles = [\n    css`\n      :host {\n        display: block;\n        font-family: var(--wa-font-sans, sans-serif);\n      }\n      wa-callout {\n        margin-bottom: 1rem;\n      }\n    `,\n    arrayFieldStyles,\n    compositionFieldStyles,\n    fileFieldStyles,\n    nullFieldStyles,\n    objectFieldStyles,\n  ];\n\n  @property({ type: Object }) accessor schema: JSONSchema = {};\n  @property({ type: Object }) accessor view: UISchema = {};\n  @property({ type: Object }) accessor data: Record<string, unknown> = {};\n  @property({ type: Object }) accessor widgets: WidgetRegistry = {};\n\n  @state() private accessor validationErrors: ValidationError[] = [];\n\n  private validator?: SchemaValidator;\n\n  protected willUpdate(changedProperties: PropertyValues) {\n    if (changedProperties.has('schema')) {\n      this.validator = createValidator(this.schema);\n      this.validate();\n    }\n    if (changedProperties.has('data')) {\n      this.validate();\n    }\n  }\n\n  private validate() {\n    if (this.validator) {\n      this.validationErrors = this.validator.validate(this.data);\n    } else {\n      this.validationErrors = [];\n    }\n  }\n\n  private handleFieldChange(key: string, value: unknown) {\n    let newData: Record<string, unknown>;\n    if (key === '') {\n      // Root update\n      newData = value as Record<string, unknown>;\n    } else {\n      // Basic immutable update\n      newData = { ...this.data, [key]: value };\n    }\n    this.data = newData;\n\n    this.dispatchEvent(\n      new CustomEvent('lsf-change', {\n        detail: { data: this.data },\n        bubbles: true,\n        composed: true,\n      }),\n    );\n    // Validation happens in willUpdate via data property change or we can force it here if simpler\n    // But since this.data is updated, requestUpdate will trigger willUpdate\n    this.requestUpdate();\n  }\n\n  private renderFields() {\n    if (!this.schema) {\n      return html`<p>No schema defined</p>`;\n    }\n\n    // Treat the entire form as a single root field\n    // Root path is empty string for consistency with Validator (\"#\" -> \"\")\n    return renderField(\n      '',\n      this.schema,\n      this.data,\n      (key, val) => this.handleFieldChange(key, val),\n      this.view || {},\n      '', // root path\n      this.validationErrors,\n      this.widgets,\n    );\n  }\n\n  render() {\n    return html`\n      <form @submit=${(e: Event) => e.preventDefault()}>\n        ${\n          this.validationErrors.length > 0\n            ? html`\n          <wa-callout variant=\"danger\" icon=\"circle-exclamation\">\n            <strong>Validation Errors</strong>\n            <ul>\n              ${this.validationErrors.map((e) => html`<li>${e.instanceLocation}: ${e.error}</li>`)}\n            </ul>\n          </wa-callout>\n        `\n            : ''\n        }\n        ${this.renderFields()}\n      </form>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'wa-json-schema-form': JsonSchemaForm;\n  }\n}\n"]}