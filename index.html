<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lit Schema Form Demo</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 1000px;
      margin: 0 auto;
    }
    h1 { margin-bottom: 2rem; }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 500px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
  </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Import Web Awesome -->
  <!-- <link rel="stylesheet" href="/node_modules/@awesome.me/webawesome/dist/styles/webawesome.css"> -->
  <link rel="stylesheet" href="https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/styles/webawesome.css">
  <!-- <script type="module" src="./src/json-schema-form.ts"></script> -->
</head>
<body>
  <!--
    Import map generated with JSPM Generator
    Edit here: https://generator.jspm.io/#TYxBDkAwFAX/wlUsfaUO8C/hANRDUU3aJnV8JBaWM5NMWRAV1J/JpgMTyZARvQM71BnjR6JZsSIxc/ZhR6i36M8qmhVukI6bt11q/+vKISyQJ3FLh03PQnNzA04OkzxuAA
  -->
  <script type="importmap">
  {
    "imports": {
      "@awesome.me/webawesome": "https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/webawesome.js",
      "@awesome.me/webawesome/": "https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/",
      "@cfworker/json-schema": "https://ga.jspm.io/npm:@cfworker/json-schema@4.1.0/dist/esm/index.js",
      "@x0k/json-schema-merge": "https://ga.jspm.io/npm:@x0k/json-schema-merge@1.0.2/dist/index.js",
      "lit": "https://ga.jspm.io/npm:lit@3.3.1/index.js",
      "lit/": "https://ga.jspm.io/npm:lit@3.3.1/",
      "json-schema-form": "./dist/json-schema-form.js",
      "composed-offset-position": "https://ga.jspm.io/npm:composed-offset-position@0.0.6/dist/composed-offset-position.browser.mjs",
      "nanoid": "https://ga.jspm.io/npm:nanoid@5.1.6/index.browser.js"
    },
    "scopes": {
      "https://ga.jspm.io/": {
        "@floating-ui/core": "https://ga.jspm.io/npm:@floating-ui/core@1.7.3/dist/floating-ui.core.mjs",
        "@floating-ui/dom": "https://ga.jspm.io/npm:@floating-ui/dom@1.7.4/dist/floating-ui.dom.mjs",
        "@floating-ui/utils": "https://ga.jspm.io/npm:@floating-ui/utils@0.2.10/dist/floating-ui.utils.mjs",
        "@floating-ui/utils/dom": "https://ga.jspm.io/npm:@floating-ui/utils@0.2.10/dist/floating-ui.utils.dom.mjs",
        "@lit/reactive-element": "https://ga.jspm.io/npm:@lit/reactive-element@2.1.1/development/reactive-element.js",
        "@lit/reactive-element/": "https://ga.jspm.io/npm:@lit/reactive-element@2.1.1/development/",
        "@shoelace-style/animations": "https://ga.jspm.io/npm:@shoelace-style/animations@1.2.0/dist/index.js",
        "@shoelace-style/localize": "https://ga.jspm.io/npm:@shoelace-style/localize@3.2.1/dist/index.js",
        "lit-element/lit-element.js": "https://ga.jspm.io/npm:lit-element@4.2.1/development/lit-element.js",
        "lit-html": "https://ga.jspm.io/npm:lit-html@3.3.1/development/lit-html.js",
        "lit-html/": "https://ga.jspm.io/npm:lit-html@3.3.1/development/",
        "lit-html/is-server.js": "https://ga.jspm.io/npm:lit-html@3.3.1/development/is-server.js"
      }
    }
  }
  </script>

  <!-- ES Module Shims import maps polyfills -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@2.7.0/dist/es-module-shims.js" crossorigin="anonymous"></script>

  <header>
    <h1>Lit Schema Form Demo</h1>
    <div class="controls">
      <label for="example-select">Load Example:</label>
      <wa-select id="example-select"></wa-select>
    </div>
  </header>

  <div class="grid">
    <div>
      <h2>Form</h2>
      <wa-json-schema-form id="form"></wa-json-schema-form>
    </div>
    <div>
      <h2>Data</h2>
      <pre id="output"></pre>
      <h2>Schema</h2>
      <pre id="schema-display"></pre>
      <h2>UI Schema</h2>
      <pre id="uischema-display"></pre>
    </div>
  </div>

  <script type="module">
    import '@awesome.me/webawesome/dist/components/button/button.js';
    import '@awesome.me/webawesome/dist/components/select/select.js';
    import '@awesome.me/webawesome/dist/components/select/select.js';
    import '@awesome.me/webawesome/dist/components/option/option.js';
    import 'json-schema-form';
    import { html } from 'lit';

    const customWidgets = {
      'custom-input': (key, schema, value, onChange) => {
        return html`
          <div style="border: 2px dashed var(--wa-color-primary-500); padding: 1rem; border-radius: 8px; background: var(--wa-color-primary-50); margin-bottom: 1rem;">
            <label style="color: var(--wa-color-primary-700); font-weight: bold; display: block; margin-bottom: 0.5rem;">${schema.title || key} âœ¨</label>
            <wa-input
              value=${value || ''}
              @wa-input=${(e) => onChange(e.target.value)}
            ></wa-input>
          </div>
        `;
      },
      'counter-widget': (key, schema, value, onChange) => {
        const count = Number(value) || 0;
        return html`
          <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1rem;">
            <label style="font-weight: bold;">${schema.title || key}</label>
            <wa-button @click=${() => onChange(count - 1)} size="small" variant="neutral">
              <wa-icon name="minus" slot="prefix"></wa-icon>
            </wa-button>
            <span style="font-size: 1.2rem; min-width: 2rem; text-align: center;">${count}</span>
            <wa-button @click=${() => onChange(count + 1)} size="small" variant="brand">
              <wa-icon name="plus" slot="prefix"></wa-icon>
            </wa-button>
          </div>
        `;
      }
    };

    const form = document.getElementById('form');
    const output = document.getElementById('output');
    const schemaDisplay = document.getElementById('schema-display');
    const uiSchemaDisplay = document.getElementById('uischema-display');
    const select = document.getElementById('example-select');

    async function loadManifest() {
      const response = await fetch('./testdata/manifest.json');
      const examples = await response.json();

      examples.forEach(name => {
        const option = document.createElement('wa-option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });

      // Load initial example
      if (examples.length > 0) {
        select.value = 'simple'; // Default preference
        loadExample('simple');
      }
    }

    async function loadExample(name) {
      if (!name) return;
      try {
        const [model, view, data] = await Promise.all([
          fetch(`./testdata/${name}/model.json`).then(r => r.json()),
          fetch(`./testdata/${name}/view.json`).then(r => r.ok ? r.json() : {}),
          fetch(`./testdata/${name}/data.json`).then(r => r.ok ? r.json() : {})
        ]);

        form.schema = model;
        form.view = view || {};
        form.data = data || {};

        // Define Custom Widgets Registry
        const widgets = {
          'custom-input': (key, schema, value, onChange) => {
             return document.createElement('div').innerHTML = `
              <div style="border: 2px dashed var(--wa-color-primary-500); padding: 10px; border-radius: 8px; background: var(--wa-color-primary-50);">
                <label style="color: var(--wa-color-primary-700); font-weight: bold; display: block; margin-bottom: 5px;">${schema.title || key} (Custom)</label>
                <wa-input
                  value="${value || ''}"
                  @wa-input="${(e) => onChange(e.target.value)}"
                  style="--border-color: var(--wa-color-primary-300);"
                ></wa-input>
              </div>
             `;
             // Note: Returning HTML string or DOM node via Lit depends on implementation.
             // Our renderField expects TemplateResult.
             // index.html uses vanilla JS, so we can't easily import `html` from `lit`.
             // However, our WidgetRenderer return type is TemplateResult.
             // We can import `html` from a CDN or use a simple object if Lit handles it, but Lit expects TemplateResult.
             // Actually, since we are in a module script, we can import { html } from 'lit'.
          },
          'counter-widget': (key, schema, value, onChange) => {
             // We will implement this in the script module below using lit.
             return null;
          }
        };

        // Wait, index.html is valid module. I can import html from lit.
        form.widgets = customWidgets;

        output.textContent = JSON.stringify(data || {}, null, 2);
        schemaDisplay.textContent = JSON.stringify(model || {}, null, 2);
        uiSchemaDisplay.textContent = JSON.stringify(view || {}, null, 2);

      } catch (e) {
        console.error('Failed to load example:', e);
        output.textContent = `Error loading example: ${e.message}`;
      }
    }

    select.addEventListener('input', (e) => {
       loadExample(e.target.value);
    });

    form.addEventListener('lsf-change', (e) => {
      output.textContent = JSON.stringify(e.detail.data, null, 2);
    });

    loadManifest();

  </script>
</body>
</html>
