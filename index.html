<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lit Schema Form Demo</title>
  <style>
    :root {
      --header-height: 60px;
      --border-color: var(--wa-color-neutral-border-normal);
      --bg-color: var(--wa-color-surface-lowered);
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      color: var(--wa-color-text-normal);
    }

    h1, h2, h3 { margin: 0; }

    /* Navbar */
    header {
      height: var(--header-height);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1.5rem;
      background: var(--wa-color-surface-default);
      border-bottom: 1px solid var(--border-color);
      flex: 0 0 auto;
    }

    header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--wa-color-text-normal);
    }

    .controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Main Layout */
    .main-layout {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    wa-split-panel {
      height: 100%;
      --divider-width: 2px;
      --divider-hit-area: 12px;
    }

    /* Left: Form */
    .form-pane {
      height: 100%;
      padding: 2rem;
      overflow-y: auto;
      background: var(--wa-color-surface-default);
    }

    .form-container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Right: Sidebar Content Containers */
    /* New Static Grid/Flex Layout */
    .sidebar-layout {
      height: 100%;
      display: flex;
      flex-direction: column;
      background: var(--bg-color);
      overflow: hidden;
    }

    .pane-content {
      flex: 1; /* 1/3 height each */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-bottom: 1px solid var(--border-color);
      min-height: 0; /* Important for flex child scrolling */
    }

    .pane-content:last-child {
      border-bottom: none;
    }

    .section-header {
      flex: 0 0 auto;
      padding: 0.5rem 1rem;
      background: var(--wa-color-neutral-fill-quiet);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--wa-color-text-quiet);
      border-bottom: 1px solid var(--border-color);
    }

    pre {
      flex: 1;
      margin: 0;
      padding: 1rem;
      overflow: auto;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    /* WebAwesome overrides */
    wa-select {
      width: 200px;
    }
  </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Import Web Awesome -->
  <link rel="stylesheet" href="https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/styles/webawesome.css">
  <link id="theme-sheet" rel="stylesheet" href="https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/styles/themes/default.css">
</head>
<body>
  <!-- Import map -->
  <script type="importmap">
  {
    "imports": {
        "@awesome.me/webawesome": "./node_modules\\@awesome.me\\webawesome/dist/webawesome.js",
        "@awesome.me/webawesome/": "./node_modules\\@awesome.me\\webawesome/",
        "@awesome.me/webawesome/dist/custom-elements-jsx.d.ts": "./node_modules/@awesome.me/webawesome/dist/custom-elements-jsx.d.ts",
        "@awesome.me/webawesome/dist/custom-elements.json": "./node_modules/@awesome.me/webawesome/dist/custom-elements.json",
        "@awesome.me/webawesome/dist/webawesome.js": "./node_modules/@awesome.me/webawesome/dist/webawesome.js",
        "@awesome.me/webawesome/dist/webawesome.loader.js": "./node_modules/@awesome.me/webawesome/dist/webawesome.loader.js",
        "@awesome.me/webawesome/package.json": "./node_modules/@awesome.me/webawesome/package.json",
        "@cfworker/json-schema": "./node_modules/@cfworker/json-schema/dist/esm/index.js",
        "@cfworker/json-schema/": "./node_modules\\@cfworker\\json-schema/",
        "@cfworker/json-schema/package.json": "./node_modules/@cfworker/json-schema/package.json",
        "@ctrl/tinycolor": "./node_modules/@ctrl/tinycolor/dist/module/public_api.js",
        "@ctrl/tinycolor/": "./node_modules\\@ctrl\\tinycolor/",
        "@floating-ui/dom": "./node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs",
        "@floating-ui/dom/": "./node_modules\\@floating-ui\\dom/",
        "@floating-ui/dom/package.json": "./node_modules/@floating-ui/dom/package.json",
        "@lit/react": "./node_modules/@lit/react/index.js",
        "@lit/react/": "./node_modules\\@lit\\react/",
        "@lit/react/use-controller.js": "./node_modules/@lit/react/use-controller.js",
        "@shoelace-style/animations": "./node_modules/@shoelace-style/animations/dist/index.js",
        "@shoelace-style/animations/": "./node_modules\\@shoelace-style\\animations/",
        "@shoelace-style/localize": "./node_modules/@shoelace-style/localize/dist/index.js",
        "@shoelace-style/localize/": "./node_modules\\@shoelace-style\\localize/",
        "@x0k/json-schema-merge": "./node_modules/@x0k/json-schema-merge/dist/index.js",
        "@x0k/json-schema-merge/": "./node_modules\\@x0k\\json-schema-merge/",
        "@x0k/json-schema-merge/package.json": "./node_modules/@x0k/json-schema-merge/package.json",
        "composed-offset-position": "./node_modules/composed-offset-position/dist/composed-offset-position.browser.min.mjs",
        "composed-offset-position/": "./node_modules\\composed-offset-position/",
        "composed-offset-position/package.json": "./node_modules/composed-offset-position/package.json",
        "lit": "./node_modules/lit/ifloandex.js",
        "lit/": "./node_modules\\lit/",
        "lit/async-directive.js": "./node_modules/lit/async-directive.js",
        "lit/decorators.js": "./node_modules/lit/decorators.js",
        "lit/decorators/custom-element.js": "./node_modules/lit/decorators/custom-element.js",
        "lit/decorators/event-options.js": "./node_modules/lit/decorators/event-options.js",
        "lit/decorators/property.js": "./node_modules/lit/decorators/property.js",
        "lit/decorators/query-all.js": "./node_modules/lit/decorators/query-all.js",
        "lit/decorators/query-assigned-elements.js": "./node_modules/lit/decorators/query-assigned-elements.js",
        "lit/decorators/query-assigned-nodes.js": "./node_modules/lit/decorators/query-assigned-nodes.js",
        "lit/decorators/query-async.js": "./node_modules/lit/decorators/query-async.js",
        "lit/decorators/query.js": "./node_modules/lit/decorators/query.js",
        "lit/decorators/state.js": "./node_modules/lit/decorators/state.js",
        "lit/directive-helpers.js": "./node_modules/lit/directive-helpers.js",
        "lit/directive.js": "./node_modules/lit/directive.js",
        "lit/directives/async-append.js": "./node_modules/lit/directives/async-append.js",
        "lit/directives/async-replace.js": "./node_modules/lit/directives/async-replace.js",
        "lit/directives/cache.js": "./node_modules/lit/directives/cache.js",
        "lit/directives/choose.js": "./node_modules/lit/directives/choose.js",
        "lit/directives/class-map.js": "./node_modules/lit/directives/class-map.js",
        "lit/directives/guard.js": "./node_modules/lit/directives/guard.js",
        "lit/directives/if-defined.js": "./node_modules/lit/directives/if-defined.js",
        "lit/directives/join.js": "./node_modules/lit/directives/join.js",
        "lit/directives/keyed.js": "./node_modules/lit/directives/keyed.js",
        "lit/directives/live.js": "./node_modules/lit/directives/live.js",
        "lit/directives/map.js": "./node_modules/lit/directives/map.js",
        "lit/directives/range.js": "./node_modules/lit/directives/range.js",
        "lit/directives/ref.js": "./node_modules/lit/directives/ref.js",
        "lit/directives/repeat.js": "./node_modules/lit/directives/repeat.js",
        "lit/directives/style-map.js": "./node_modules/lit/directives/style-map.js",
        "lit/directives/template-content.js": "./node_modules/lit/directives/template-content.js",
        "lit/directives/unsafe-html.js": "./node_modules/lit/directives/unsafe-html.js",
        "lit/directives/unsafe-mathml.js": "./node_modules/lit/directives/unsafe-mathml.js",
        "lit/directives/unsafe-svg.js": "./node_modules/lit/directives/unsafe-svg.js",
        "lit/directives/until.js": "./node_modules/lit/directives/until.js",
        "lit/directives/when.js": "./node_modules/lit/directives/when.js",
        "lit/html.js": "./node_modules/lit/html.js",
        "lit/polyfill-support.js": "./node_modules/lit/polyfill-support.js",
        "lit/static-html.js": "./node_modules/lit/static-html.js",
        "nanoid": "./node_modules/nanoid/index.browser.js",
        "nanoid/": "./node_modules\\nanoid/",
        "nanoid/non-secure": "./node_modules/nanoid/non-secure/index.js",
        "nanoid/package.json": "./node_modules/nanoid/package.json",
        "qr-creator": "./node_modules/qr-creator/dist/qr-creator.es6.min.js",
        "qr-creator/": "./node_modules\\qr-creator/"
    },
    "scopes": {
        "./node_modules/": {
            "@floating-ui/core": "./node_modules/@floating-ui/core/dist/floating-ui.core.mjs",
            "@floating-ui/utils": "./node_modules/@floating-ui/utils/dist/floating-ui.utils.mjs",
            "@floating-ui/utils/dom": "./node_modules/@floating-ui/utils/dist/floating-ui.utils.dom.mjs",
            "@lit/reactive-element": "./node_modules/@lit/reactive-element/reactive-element.js",
            "@lit/reactive-element/decorators/": "./node_modules/@lit/reactive-element/decorators/",
            "lit-element/lit-element.js": "./node_modules/lit-element/lit-element.js",
            "lit-html": "./node_modules/lit-html/lit-html.js",
            "lit-html/": "./node_modules/lit-html/"
        }
    }
  }
  </script>

  <!-- ES Module Shims -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@2.7.0/dist/es-module-shims.js" crossorigin="anonymous"></script>

  <header>
    <h1>Lit Schema Form</h1>
    <div class="controls">
      <wa-select id="theme-select" value="default" size="small" style="width: 140px;">
        <wa-option value="default">Default</wa-option>
        <wa-option value="awesome">Awesome</wa-option>
        <wa-option value="shoelace">Shoelace</wa-option>
      </wa-select>
      <wa-button id="mode-toggle"><wa-icon name="sun"></wa-icon></wa-button>
      <wa-select id="example-select" placeholder="Select Example" size="small"></wa-select>
    </div>
  </header>

  <main class="main-layout">
    <wa-split-panel position="60">

      <!-- Start: Form -->
      <div slot="start" class="form-pane">
        <div class="form-container">
          <wa-json-schema-form id="form"></wa-json-schema-form>
        </div>
      </div>

      <!-- End: Sidebar (Static Grid) -->
      <div slot="end" class="sidebar-layout">

        <!-- Data -->
        <div class="pane-content">
          <div class="section-header">Data</div>
          <pre id="output"></pre>
        </div>

        <!-- Schema -->
        <div class="pane-content">
          <div class="section-header">Schema</div>
          <pre id="schema-display"></pre>
        </div>

        <!-- UI Schema -->
        <div class="pane-content">
          <div class="section-header">UI Schema</div>
          <pre id="uischema-display"></pre>
        </div>

      </div>
    </wa-split-panel>
  </main>

  <script type="module">
    import '@awesome.me/webawesome/dist/components/button/button.js';
    import '@awesome.me/webawesome/dist/components/select/select.js';
    import '@awesome.me/webawesome/dist/components/option/option.js';
    import '@awesome.me/webawesome/dist/components/input/input.js';
    import '@awesome.me/webawesome/dist/components/icon/icon.js';
    import '@awesome.me/webawesome/dist/components/split-panel/split-panel.js';
    import 'json-schema-form';
    import { html } from 'lit';

    const customWidgets = {
      'custom-input': (key, schema, value, onChange) => {
        return html`
          <div style="border: 2px dashed var(--wa-color-primary-500); padding: 1rem; border-radius: 8px; background: var(--wa-color-primary-50); margin-bottom: 1rem;">
            <label style="color: var(--wa-color-primary-700); font-weight: bold; display: block; margin-bottom: 0.5rem;">${schema.title || key} âœ¨</label>
            <wa-input
              value=${value || ''}
              @wa-input=${(e) => onChange(e.target.value)}
            ></wa-input>
          </div>
        `;
      },
      'counter-widget': (key, schema, value, onChange) => {
        const count = Number(value) || 0;
        return html`
          <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1rem;">
            <label style="font-weight: bold;">${schema.title || key}</label>
            <wa-button @click=${() => onChange(count - 1)} size="small" variant="neutral">
              <wa-icon name="minus" slot="prefix"></wa-icon>
            </wa-button>
            <span style="font-size: 1.2rem; min-width: 2rem; text-align: center;">${count}</span>
            <wa-button @click=${() => onChange(count + 1)} size="small" variant="brand">
              <wa-icon name="plus" slot="prefix"></wa-icon>
            </wa-button>
          </div>
        `;
      }
    };

    const form = document.getElementById('form');
    const output = document.getElementById('output');
    const schemaDisplay = document.getElementById('schema-display');
    const uiSchemaDisplay = document.getElementById('uischema-display');
    const select = document.getElementById('example-select');

    // Theme & Mode Controls
    const themeSelect = document.getElementById('theme-select');
    const themeSheet = document.getElementById('theme-sheet');
    const modeToggle = document.getElementById('mode-toggle');

    // Theme Switching
    themeSelect.addEventListener('input', (e) => {
      const theme = e.target.value;
      themeSheet.href = `https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/styles/themes/${theme}.css`;
      // Remove wa-theme-* classes
      for (const className of document.documentElement.classList) {
        if (className.startsWith('wa-theme-')) {
          document.documentElement.classList.remove(className);
        }
      }
      // Add wa-theme-{theme} class
      document.documentElement.classList.add(`wa-theme-${theme}`);
    });

    // Dark Mode Toggle
    modeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('wa-dark');
      modeToggle.querySelector('wa-icon')?.setAttribute('name', isDark ? 'moon' : 'sun');
    });

    async function loadManifest() {
      try {
        const response = await fetch('./testdata/manifest.json');
        const examples = await response.json();

        // Clear existing options
        select.innerHTML = '';

        examples.forEach(name => {
          const option = document.createElement('wa-option');
          option.value = name;
          option.textContent = name;
          select.appendChild(option);
        });

        // Load initial example
        if (examples.length > 0) {
          select.value = 'simple'; // Default preference
          loadExample('simple');
        }
      } catch (e) {
        console.error("Failed to load manifest", e);
      }
    }

    async function loadExample(name) {
      if (!name) return;
      try {
        const [model, view, data] = await Promise.all([
          fetch(`./testdata/${name}/model.json`).then(r => r.json()),
          fetch(`./testdata/${name}/view.json`).then(r => r.ok ? r.json() : {}),
          fetch(`./testdata/${name}/data.json`).then(r => r.ok ? r.json() : {})
        ]);

        form.schema = model;
        form.view = view || {};
        form.data = data || {};
        form.widgets = customWidgets;

        output.textContent = JSON.stringify(data || {}, null, 2);
        schemaDisplay.textContent = JSON.stringify(model || {}, null, 2);
        uiSchemaDisplay.textContent = JSON.stringify(view || {}, null, 2);

      } catch (e) {
        console.error('Failed to load example:', e);
        output.textContent = `Error loading example: ${e.message}`;
      }
    }

    select.addEventListener('wa-input', (e) => {
       loadExample(e.target.value);
    });

    form.addEventListener('lsf-change', (e) => {
      output.textContent = JSON.stringify(e.detail.data, null, 2);
    });

    loadManifest();

  </script>
</body>
</html>
