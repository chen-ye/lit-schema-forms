<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lit Schema Form Demo</title>
  <style>
    :root {
      --header-height: 60px;
      --border-color: #e2e8f0;
      --bg-color: #f8fafc;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      color: #334155;
    }

    h1, h2, h3 { margin: 0; }

    /* Navbar */
    header {
      height: var(--header-height);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1.5rem;
      background: white;
      border-bottom: 1px solid var(--border-color);
      flex: 0 0 auto;
    }

    header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #0f172a;
    }

    .controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Main Layout */
    .main-layout {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    wa-split-panel {
      height: 100%;
      --divider-width: 2px;
      --divider-hit-area: 12px;
    }

    /* Left: Form */
    .form-pane {
      height: 100%;
      padding: 2rem;
      overflow-y: auto;
      background: #fff;
    }

    .form-container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Right: Sidebar Content Containers */
    /* New Static Grid/Flex Layout */
    .sidebar-layout {
      height: 100%;
      display: flex;
      flex-direction: column;
      background: var(--bg-color);
      overflow: hidden;
    }

    .pane-content {
      flex: 1; /* 1/3 height each */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-bottom: 1px solid var(--border-color);
      min-height: 0; /* Important for flex child scrolling */
    }

    .pane-content:last-child {
      border-bottom: none;
    }

    .section-header {
      flex: 0 0 auto;
      padding: 0.5rem 1rem;
      background: #f1f5f9;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      border-bottom: 1px solid var(--border-color);
    }

    pre {
      flex: 1;
      margin: 0;
      padding: 1rem;
      overflow: auto;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    /* WebAwesome overrides */
    wa-select {
      width: 200px;
    }
  </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Import Web Awesome -->
  <link rel="stylesheet" href="https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/styles/webawesome.css">
</head>
<body>
  <!-- Import map -->
  <script type="importmap">
  {
    "imports": {
      "@awesome.me/webawesome": "https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/dist/webawesome.js",
      "@awesome.me/webawesome/": "https://ga.jspm.io/npm:@awesome.me/webawesome@3.0.0/",
      "@cfworker/json-schema": "https://ga.jspm.io/npm:@cfworker/json-schema@4.1.0/dist/esm/index.js",
      "@x0k/json-schema-merge": "https://ga.jspm.io/npm:@x0k/json-schema-merge@1.0.2/dist/index.js",
      "lit": "https://ga.jspm.io/npm:lit@3.3.1/index.js",
      "lit/": "https://ga.jspm.io/npm:lit@3.3.1/",
      "json-schema-form": "./dist/json-schema-form.js",
      "composed-offset-position": "https://ga.jspm.io/npm:composed-offset-position@0.0.6/dist/composed-offset-position.browser.mjs",
      "nanoid": "https://ga.jspm.io/npm:nanoid@5.1.6/index.browser.js"
    },
    "scopes": {
      "https://ga.jspm.io/": {
        "@floating-ui/core": "https://ga.jspm.io/npm:@floating-ui/core@1.7.3/dist/floating-ui.core.mjs",
        "@floating-ui/dom": "https://ga.jspm.io/npm:@floating-ui/dom@1.7.4/dist/floating-ui.dom.mjs",
        "@floating-ui/utils": "https://ga.jspm.io/npm:@floating-ui/utils@0.2.10/dist/floating-ui.utils.mjs",
        "@floating-ui/utils/dom": "https://ga.jspm.io/npm:@floating-ui/utils@0.2.10/dist/floating-ui.utils.dom.mjs",
        "@lit/reactive-element": "https://ga.jspm.io/npm:@lit/reactive-element@2.1.1/development/reactive-element.js",
        "@lit/reactive-element/": "https://ga.jspm.io/npm:@lit/reactive-element@2.1.1/development/",
        "@shoelace-style/animations": "https://ga.jspm.io/npm:@shoelace-style/animations@1.2.0/dist/index.js",
        "@shoelace-style/localize": "https://ga.jspm.io/npm:@shoelace-style/localize@3.2.1/dist/index.js",
        "lit-element/lit-element.js": "https://ga.jspm.io/npm:lit-element@4.2.1/development/lit-element.js",
        "lit-html": "https://ga.jspm.io/npm:lit-html@3.3.1/development/lit-html.js",
        "lit-html/": "https://ga.jspm.io/npm:lit-html@3.3.1/development/",
        "lit-html/is-server.js": "https://ga.jspm.io/npm:lit-html@3.3.1/development/is-server.js"
      }
    }
  }
  </script>

  <!-- ES Module Shims -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@2.7.0/dist/es-module-shims.js" crossorigin="anonymous"></script>

  <header>
    <h1>Lit Schema Form</h1>
    <div class="controls">
      <wa-select id="example-select" placeholder="Select Example" size="small"></wa-select>
    </div>
  </header>

  <main class="main-layout">
    <wa-split-panel position="60">

      <!-- Start: Form -->
      <div slot="start" class="form-pane">
        <div class="form-container">
          <wa-json-schema-form id="form"></wa-json-schema-form>
        </div>
      </div>

      <!-- End: Sidebar (Static Grid) -->
      <div slot="end" class="sidebar-layout">

        <!-- Data -->
        <div class="pane-content">
          <div class="section-header">Data</div>
          <pre id="output"></pre>
        </div>

        <!-- Schema -->
        <div class="pane-content">
          <div class="section-header">Schema</div>
          <pre id="schema-display"></pre>
        </div>

        <!-- UI Schema -->
        <div class="pane-content">
          <div class="section-header">UI Schema</div>
          <pre id="uischema-display"></pre>
        </div>

      </div>
    </wa-split-panel>
  </main>

  <script type="module">
    import '@awesome.me/webawesome/dist/components/button/button.js';
    import '@awesome.me/webawesome/dist/components/select/select.js';
    import '@awesome.me/webawesome/dist/components/option/option.js';
    import '@awesome.me/webawesome/dist/components/input/input.js';
    import '@awesome.me/webawesome/dist/components/icon/icon.js';
    import '@awesome.me/webawesome/dist/components/split-panel/split-panel.js';
    import 'json-schema-form';
    import { html } from 'lit';

    const customWidgets = {
      'custom-input': (key, schema, value, onChange) => {
        return html`
          <div style="border: 2px dashed var(--wa-color-primary-500); padding: 1rem; border-radius: 8px; background: var(--wa-color-primary-50); margin-bottom: 1rem;">
            <label style="color: var(--wa-color-primary-700); font-weight: bold; display: block; margin-bottom: 0.5rem;">${schema.title || key} âœ¨</label>
            <wa-input
              value=${value || ''}
              @wa-input=${(e) => onChange(e.target.value)}
            ></wa-input>
          </div>
        `;
      },
      'counter-widget': (key, schema, value, onChange) => {
        const count = Number(value) || 0;
        return html`
          <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1rem;">
            <label style="font-weight: bold;">${schema.title || key}</label>
            <wa-button @click=${() => onChange(count - 1)} size="small" variant="neutral">
              <wa-icon name="minus" slot="prefix"></wa-icon>
            </wa-button>
            <span style="font-size: 1.2rem; min-width: 2rem; text-align: center;">${count}</span>
            <wa-button @click=${() => onChange(count + 1)} size="small" variant="brand">
              <wa-icon name="plus" slot="prefix"></wa-icon>
            </wa-button>
          </div>
        `;
      }
    };

    const form = document.getElementById('form');
    const output = document.getElementById('output');
    const schemaDisplay = document.getElementById('schema-display');
    const uiSchemaDisplay = document.getElementById('uischema-display');
    const select = document.getElementById('example-select');

    async function loadManifest() {
      try {
        const response = await fetch('./testdata/manifest.json');
        const examples = await response.json();

        // Clear existing options
        select.innerHTML = '';

        examples.forEach(name => {
          const option = document.createElement('wa-option');
          option.value = name;
          option.textContent = name;
          select.appendChild(option);
        });

        // Load initial example
        if (examples.length > 0) {
          select.value = 'simple'; // Default preference
          loadExample('simple');
        }
      } catch (e) {
        console.error("Failed to load manifest", e);
      }
    }

    async function loadExample(name) {
      if (!name) return;
      try {
        const [model, view, data] = await Promise.all([
          fetch(`./testdata/${name}/model.json`).then(r => r.json()),
          fetch(`./testdata/${name}/view.json`).then(r => r.ok ? r.json() : {}),
          fetch(`./testdata/${name}/data.json`).then(r => r.ok ? r.json() : {})
        ]);

        form.schema = model;
        form.view = view || {};
        form.data = data || {};
        form.widgets = customWidgets;

        output.textContent = JSON.stringify(data || {}, null, 2);
        schemaDisplay.textContent = JSON.stringify(model || {}, null, 2);
        uiSchemaDisplay.textContent = JSON.stringify(view || {}, null, 2);

      } catch (e) {
        console.error('Failed to load example:', e);
        output.textContent = `Error loading example: ${e.message}`;
      }
    }

    select.addEventListener('wa-input', (e) => {
       loadExample(e.target.value);
    });

    form.addEventListener('lsf-change', (e) => {
      output.textContent = JSON.stringify(e.detail.data, null, 2);
    });

    loadManifest();

  </script>
</body>
</html>
